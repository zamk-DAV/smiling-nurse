<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>스마일링 널스 - 오늘의 기록</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    /* 7번 요구사항: 식사 규칙성 체크박스 스타일 */
    .checkbox-group-wrapper {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }
    .checkbox-group-styled {
      /* 전체 영역을 클릭 가능하게 만들고 윤곽선 추가 */
      padding: 12px 20px;
      border: 2px solid var(--secondary-green); /* CSS 변수 직접 사용 */
      border-radius: 12px;
      transition: all 0.2s ease-in-out;
      cursor: pointer;
      display: flex;
      align-items: center;
      user-select: none; /* 텍스트 드래그 방지 */
      background: linear-gradient(135deg, var(--white), rgba(255, 255, 255, 0.8));
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }
    .checkbox-group-styled:hover {
      border-color: var(--primary-green);
      background-color: var(--light-green); /* CSS 변수 직접 사용 */
    }
    .checkbox-group-styled input[type="checkbox"]:checked + label {
      color: var(--primary-green);
      font-weight: 600;
    }
    .checkbox-group-styled input[type="checkbox"] {
      margin-right: 10px;
      width: 18px;
      height: 18px;
    }

    /* 5, 8번 요구사항: 슬라이더 값 텍스트 위치를 동적으로 조정 */
    .range-value-container {
      margin-top: 8px;
      position: relative;
      width: 100%;
      height: 24px;
    }

    /* 슬라이더 값 텍스트 (5/10에서 5 부분) */
    .range-value {
      position: absolute;
      top: 0;
      font-size: 24px; 
      font-weight: 700; 
      color: var(--primary-green);
      
      /* JS에서 설정한 --range-value (0%~100%)를 기준으로 위치를 계산 */
      left: var(--range-value, 50%); 
      transform: translateX(calc(-50% - 12px)); /* 50% 중앙 정렬 및 보정 */
      
      transition: transform 0.1s linear, left 0.1s linear;
    }
    
    /* 5/10에서 /10 부분 */
    .range-value-max {
        position: absolute;
        top: 0;
        color: var(--text-gray);
        font-size: 24px; 
        font-weight: 700; 
        
        /* JS에서 설정한 --range-value (0%~100%)를 기준으로 위치를 계산 */
        left: var(--range-value, 50%);
        transform: translateX(calc(-50% + 12px)); /* 50% 중앙 정렬 및 보정 */
        
        transition: transform 0.1s linear, left 0.1s linear;
    }
  </style>
</head>
<body>
  <script>
    function initializeRangeValues() {
      // 모든 range input 찾기
      const sliders = document.querySelectorAll('input[type="range"]');
      sliders.forEach(slider => {
        // oninput 로직과 동일하게 초기값 설정
        // **수정: const 대신 let 또는 var 사용, 혹은 아래처럼 선언 키워드 없이 직접 사용**
        var percentage = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
        if (slider.nextElementSibling) {
          slider.nextElementSibling.style.setProperty('--range-value', percentage + '%');
        }
      });
    }
    // 페이지 로드 시 실행
    document.addEventListener('DOMContentLoaded', initializeRangeValues);
  </script>
  
  <nav class="nav">
    <a href="dashboard.html" class="nav-brand" style="text-decoration: none; color: inherit; cursor: pointer;">
      <span>😊🩺</span>
      <span>스마일링 널스</span>
    </a>
    <ul class="nav-menu">
      <li><a href="dashboard.html">대시보드</a></li>
      <li><a href="daily-check.html" class="active">오늘의 기록</a></li>
      <li><a href="statistics.html">통계</a></li>
      <li><a href="profile.html">프로필</a></li>
      <li><a href="#" onclick="logout()">로그아웃</a></li>
    </ul>
  </nav>

  <div class="container">
    <div class="card" style="max-width: 900px; margin: 0 auto;">
      <div class="header">
        <div class="logo">📝</div>
        <h1>오늘의 건강 기록</h1>
        <p>오늘 하루를 돌아보며 기록해주세요</p>
      </div>

      <form id="daily-check-form">
        <div class="card" style="background: var(--light-green); margin-bottom: 24px; padding: 24px;">
          <h2 style="color: var(--primary-green); margin-bottom: 20px;">📊 오늘의 상태</h2>

          <div class="grid grid-2">
            <div class="form-group">
              <label for="work-type">근무 형태</label>
              <select id="work-type" name="workType" required>
                <option value="">선택하세요</option>
                <option value="3교대">3교대</option>
                <option value="상근직">상근직</option>
              </select>
            </div>

            <div class="form-group" id="shift-type-group" style="display: none;">
              <label for="shift-type">근무 시간</label>
              <select id="shift-type" name="shiftType">
                <option value="">선택하세요</option>
                <option value="데이(Day)">데이 (Day)</option>
                <option value="이브닝(Evening)">이브닝 (Evening)</option>
                <option value="나이트(Night)">나이트 (Night)</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="stress-level">오늘의 스트레스 수준 (1-10점)</label>
            <input type="range" id="stress-level" name="stressLevel" min="1" max="10" value="5" step="1" style="width: 100%;" 
                   oninput="
                     document.getElementById('stress-value').textContent = this.value; 
                     var percentage = ((this.value - this.min) / (this.max - this.min)) * 100;
                     this.nextElementSibling.style.setProperty('--range-value', percentage + '%');
                   ">
            <div class="range-value-container" id="stress-range-container" style="--range-value: 50%;"> 
              <span class="range-value" id="stress-value">5</span>
              <span class="range-value-max" style="color: var(--text-gray);">/ 10</span>
            </div>
          </div>

          <div class="grid grid-2">
            <div class="form-group">
              <label>수면 시간</label>
              <div style="display: flex; gap: 12px; align-items: flex-start;">
                <div style="flex: 1;">
                  <input type="number" id="sleep-hours" name="sleepHours" min="0" max="23" value="0" step="1" required>
                  <small style="color: var(--text-gray); display: block; margin-top: 4px; text-align: center;">시간</small>
                </div>
                <div style="flex: 1;">
                  <input type="number" id="sleep-minutes" name="sleepMinutes" min="0" max="59" value="0" step="1" required>
                  <small style="color: var(--text-gray); display: block; margin-top: 4px; text-align: center;">분</small>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="sleep-quality">수면의 질 (1-5점)</label>
              <select id="sleep-quality" name="sleepQuality">
                <option value="">선택하세요</option>
                <option value="1">1 - 매우 나쁨</option>
                <option value="2">2 - 나쁨</option>
                <option value="3">3 - 보통</option>
                <option value="4">4 - 좋음</option>
                <option value="5">5 - 매우 좋음</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>식사 규칙성</label>
            <div class="checkbox-group-wrapper">
              <div class="checkbox-group-styled">
                <input type="checkbox" id="breakfast" name="meals" value="breakfast">
                <label for="breakfast">아침</label>
              </div>
              <div class="checkbox-group-styled">
                <input type="checkbox" id="lunch" name="meals" value="lunch">
                <label for="lunch">점심</label>
              </div>
              <div class="checkbox-group-styled">
                <input type="checkbox" id="dinner" name="meals" value="dinner">
                <label for="dinner">저녁</label>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="work-intensity">업무 강도 (1-10점)</label>
            <input type="range" id="work-intensity" name="workIntensity" min="1" max="10" value="5" step="1" style="width: 100%;" 
                   oninput="
                     document.getElementById('work-value').textContent = this.value;
                     var percentage = ((this.value - this.min) / (this.max - this.min)) * 100;
                     this.nextElementSibling.style.setProperty('--range-value', percentage + '%');
                   ">
            <div class="range-value-container" id="work-range-container" style="--range-value: 50%;">
              <span class="range-value" id="work-value">5</span>
              <span class="range-value-max" style="color: var(--text-gray);">/ 10</span>
            </div>
          </div>
        </div>

        <div class="card" style="background: var(--accent-blue); margin-bottom: 24px; padding: 24px;">
          <h2 style="color: var(--primary-green); margin-bottom: 20px;">💊 건강 지표 (선택사항)</h2>

          <div class="grid grid-2">
            <div class="form-group">
              <label for="blood-sugar">혈당 (mg/dL)</label>
              <input type="number" id="blood-sugar" name="bloodSugar" min="0" max="600" placeholder="예: 100">
            </div>

            <div class="form-group">
              <label for="steps">걸음 수</label>
              <input type="number" id="steps" name="steps" min="0" max="100000" placeholder="예: 8000">
            </div>
          </div>

          <div class="grid grid-2">
            <div class="form-group">
              <label for="bp-systolic">혈압 - 수축기 (mmHg)</label>
              <input type="number" id="bp-systolic" name="bloodPressureSystolic" min="0" max="300" placeholder="예: 120">
            </div>

            <div class="form-group">
              <label for="bp-diastolic">혈압 - 이완기 (mmHg)</label>
              <input type="number" id="bp-diastolic" name="bloodPressureDiastolic" min="0" max="200" placeholder="예: 80">
            </div>
          </div>
        </div>

        <!-- 간호사 스트레스 측정도구 (19문항, 4점 척도) -->
        <div class="card" style="background: var(--accent-pink); margin-bottom: 24px; padding: 24px;">
          <h2 style="color: var(--primary-green); margin-bottom: 12px;">🏥 간호사 스트레스 측정도구</h2>
          <p style="color: var(--text-gray); margin-bottom: 20px; font-size: 14px;">최근 업무 중 다음 상황들에 대해 어떻게 느끼셨는지 표시해주세요.</p>

          <div class="stress-questions">
            <!-- 요인 1: 업무과중 (1-9번) -->
            <h3 style="color: var(--primary-green); margin: 20px 0 16px 0; font-size: 16px;">💼 업무과중</h3>

            <div class="form-group">
              <label>1. 정해진 시간 내에 해결해야 할 일이 많아 시간에 쫓겨 벅차다.</label>
              <select name="stress1" required>
                <option value="">선택하세요</option>
                <option value="1">전혀 그렇지 않다</option>
                <option value="2">그렇지 않다</option>
                <option value="3">그렇다</option>
                <option value="4">매우 그렇다</option>
              </select>
            </div>

            <div class="form-group">
              <label>2. 돌발적인 업무 발생에 대해 불안하다.</label>
              <select name="stress2" required>
                <option value="">선택하세요</option>
                <option value="1">전혀 그렇지 않다</option>
                <option value="2">그렇지 않다</option>
                <option value="3">그렇다</option>
                <option value="4">매우 그렇다</option>
              </select>
            </div>

            <div class="form-group">
              <label>3. 동시에 많은 업무를 해결해야 해서 벅차다.</label>
              <select name="stress3" required>
                <option value="">선택하세요</option>
                <option value="1">전혀 그렇지 않다</option>
                <option value="2">그렇지 않다</option>
                <option value="3">그렇다</option>
                <option value="4">매우 그렇다</option>
              </select>
            </div>

            <div class="form-group">
              <label>4. 일이 너무 많아서 잘 해내지 못할 것 같아 걱정된다.</label>
              <select name="stress4" required>
                <option value="">선택하세요</option>
                <option value="1">전혀 그렇지 않다</option>
                <option value="2">그렇지 않다</option>
                <option value="3">그렇다</option>
                <option value="4">매우 그렇다</option>
              </select>
            </div>

            <div class="form-group">
              <label>5. 내가 확인하지 못한 사이 환자안전사고가 발생할까 불안하다.</label>
              <select name="stress5" required>
                <option value="">선택하세요</option>
                <option value="1">전혀 그렇지 않다</option>
                <option value="2">그렇지 않다</option>
                <option value="3">그렇다</option>
                <option value="4">매우 그렇다</option>
              </select>
            </div>

            <div class="form-group">
              <label>6. 신속한 판단을 내려야 하는 상황에 처했을 때 마음이 조급해진다.</label>
              <select name="stress6" required>
                <option value="">선택하세요</option>
                <option value="1">전혀 그렇지 않다</option>
                <option value="2">그렇지 않다</option>
                <option value="3">그렇다</option>
                <option value="4">매우 그렇다</option>
              </select>
            </div>

            <div class="form-group">
              <label>7. 밥을 먹거나 화장실 갈 시간이 부족하여 고달프다.</label>
              <select name="stress7" required>
                <option value="">선택하세요</option>
                <option value="1">전혀 그렇지 않다</option>
                <option value="2">그렇지 않다</option>
                <option value="3">그렇다</option>
                <option value="4">매우 그렇다</option>
              </select>
            </div>

            <div class="form-group">
              <label>8. 환자/보호자의 간호 요구 (환자 상태 악화, 수술, 특수 처치 등)가 증가할 때 힘겹다.</label>
              <select name="stress8" required>
                <option value="">선택하세요</option>
                <option value="1">전혀 그렇지 않다</option>
                <option value="2">그렇지 않다</option>
                <option value="3">그렇다</option>
                <option value="4">매우 그렇다</option>
              </select>
            </div>

            <div class="form-group">
              <label>9. 너무 바빠서 환자에게 충분히 간호할 시간이 없어 안타깝다.</label>
              <select name="stress9" required>
                <option value="">선택하세요</option>
                <option value="1">전혀 그렇지 않다</option>
                <option value="2">그렇지 않다</option>
                <option value="3">그렇다</option>
                <option value="4">매우 그렇다</option>
              </select>
            </div>

            <!-- 요인 2: 감정노동 (10-12번) -->
            <h3 style="color: var(--primary-green); margin: 32px 0 16px 0; font-size: 16px;">😔 감정노동</h3>

            <div class="form-group">
              <label>10. 환자/보호자에게 존중받지 못할 때 불쾌하다.</label>
              <select name="stress10" required>
                <option value="">선택하세요</option>
                <option value="1">전혀 그렇지 않다</option>
                <option value="2">그렇지 않다</option>
                <option value="3">그렇다</option>
                <option value="4">매우 그렇다</option>
              </select>
            </div>

            <div class="form-group">
              <label>11. 환자/보호자로부터 폭력 (폭언, 폭행, 불법 촬영/녹음 등)을 당하거나 목격할 때 회의감이 든다.</label>
              <select name="stress11" required>
                <option value="">선택하세요</option>
                <option value="1">전혀 그렇지 않다</option>
                <option value="2">그렇지 않다</option>
                <option value="3">그렇다</option>
                <option value="4">매우 그렇다</option>
              </select>
            </div>

            <div class="form-group">
              <label>12. 환자/보호자가 부당한 요구를 할 때 난처하다.</label>
              <select name="stress12" required>
                <option value="">선택하세요</option>
                <option value="1">전혀 그렇지 않다</option>
                <option value="2">그렇지 않다</option>
                <option value="3">그렇다</option>
                <option value="4">매우 그렇다</option>
              </select>
            </div>

            <!-- 요인 3: 개인적 특성 (13-15번) -->
            <h3 style="color: var(--primary-green); margin: 32px 0 16px 0; font-size: 16px;">👤 개인적 특성</h3>

            <div class="form-group">
              <label>13. 나의 간호실무 역량이 충분하지 않아 자괴감이 든다.</label>
              <select name="stress13" required>
                <option value="">선택하세요</option>
                <option value="1">전혀 그렇지 않다</option>
                <option value="2">그렇지 않다</option>
                <option value="3">그렇다</option>
                <option value="4">매우 그렇다</option>
              </select>
            </div>

            <div class="form-group">
              <label>14. 간호사로서 발전하지 못하는 내 모습에 좌절감을 느낀다.</label>
              <select name="stress14" required>
                <option value="">선택하세요</option>
                <option value="1">전혀 그렇지 않다</option>
                <option value="2">그렇지 않다</option>
                <option value="3">그렇다</option>
                <option value="4">매우 그렇다</option>
              </select>
            </div>

            <div class="form-group">
              <label>15. 환자/보호자와 의사소통 하는 것이 두렵다.</label>
              <select name="stress15" required>
                <option value="">선택하세요</option>
                <option value="1">전혀 그렇지 않다</option>
                <option value="2">그렇지 않다</option>
                <option value="3">그렇다</option>
                <option value="4">매우 그렇다</option>
              </select>
            </div>

            <!-- 요인 4: 조직적 특성 (16-19번) -->
            <h3 style="color: var(--primary-green); margin: 32px 0 16px 0; font-size: 16px;">🏢 조직적 특성</h3>

            <div class="form-group">
              <label>16. 간호관리자가 나의 요구 사항 (듀티요청 등)을 존중하지 않아 속상하다.</label>
              <select name="stress16" required>
                <option value="">선택하세요</option>
                <option value="1">전혀 그렇지 않다</option>
                <option value="2">그렇지 않다</option>
                <option value="3">그렇다</option>
                <option value="4">매우 그렇다</option>
              </select>
            </div>

            <div class="form-group">
              <label>17. 직장의 분위기가 위계적이어서 갑갑하다.</label>
              <select name="stress17" required>
                <option value="">선택하세요</option>
                <option value="1">전혀 그렇지 않다</option>
                <option value="2">그렇지 않다</option>
                <option value="3">그렇다</option>
                <option value="4">매우 그렇다</option>
              </select>
            </div>

            <div class="form-group">
              <label>18. 체계적이고 충분한 직무교육을 제공받지 못해 불만족스럽다.</label>
              <select name="stress18" required>
                <option value="">선택하세요</option>
                <option value="1">전혀 그렇지 않다</option>
                <option value="2">그렇지 않다</option>
                <option value="3">그렇다</option>
                <option value="4">매우 그렇다</option>
              </select>
            </div>

            <div class="form-group">
              <label>19. 간호관리자로부터 부적절한 업무지시를 받을 때 화가 난다.</label>
              <select name="stress19" required>
                <option value="">선택하세요</option>
                <option value="1">전혀 그렇지 않다</option>
                <option value="2">그렇지 않다</option>
                <option value="3">그렇다</option>
                <option value="4">매우 그렇다</option>
              </select>
            </div>
          </div>
        </div>

        <div class="card" style="margin-bottom: 24px; padding: 24px;">
          <h2 style="color: var(--primary-green); margin-bottom: 20px;">💬 오늘 하고 싶은 말</h2>
          <div class="form-group">
            <textarea id="notes" name="notes" placeholder="오늘 하루 어떠셨나요? 자유롭게 기록해보세요..." rows="6"></textarea>
          </div>
        </div>

        <div style="display: flex; gap: 12px;">
          <button type="button" onclick="startConversationMode()" class="btn btn-secondary" style="flex: 1;">
            🎤 AI와 대화하기
          </button>
          <button type="submit" class="btn btn-primary" style="flex: 1;">
            💾 저장하기
          </button>
        </div>
      </form>
    </div>
  </div>

  <script src="js/config.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/daily-check.js"></script>

  <!-- Select 드롭다운 개선 스크립트 -->
  <script>
    // 모든 select 요소에 대한 개선
    document.addEventListener('DOMContentLoaded', () => {
      const allSelects = document.querySelectorAll('select');

      allSelects.forEach(select => {
        // Select가 포커스될 때 화면 중앙으로 부드럽게 스크롤
        select.addEventListener('focus', function() {
          setTimeout(() => {
            this.scrollIntoView({
              behavior: 'smooth',
              block: 'center',
              inline: 'nearest'
            });
          }, 100);
        });

        // 모바일에서 select 열릴 때 더 나은 처리
        select.addEventListener('mousedown', function(e) {
          // Select의 현재 위치 저장
          const rect = this.getBoundingClientRect();
          const viewportHeight = window.innerHeight;

          // Select가 화면 하단에 너무 가까우면 위로 스크롤
          if (rect.bottom > viewportHeight - 100) {
            this.scrollIntoView({
              behavior: 'smooth',
              block: 'center'
            });
          }
        });

        // 선택 완료 시 포커스 해제 (키보드 숨김)
        select.addEventListener('change', function() {
          this.blur();
        });
      });
    });
  </script>
</body>
</html>